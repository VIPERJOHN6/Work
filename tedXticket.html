<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://sdk.monnify.com/plugin/monnify.js"></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TEDx - TAU</title>
  <!-- Bootstrap + Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <link rel="stylesheet" href="button.css" />
    <link rel="icon" type="image/x-icon" href="images/tau.png">


</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark shadow-sm">
  <div class="container-fluid px-4">

    <!-- Brand Logo + Text -->
    <a class="navbar-brand d-flex align-items-center" href="#">
      <img src="./images/tau.png" alt="Logo" style="height: 40px; width: 100%;" class="me-2" />
    </a>

    <!-- Toggler for mobile -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Nav Links -->
    <div class="collapse navbar-collapse" id="navbarNavDropdown">
      <ul class="navbar-nav ms-auto me-2">
        <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="about.html">About</a></li>
        <li class="nav-item"><a class="nav-link" href="event.html">Events</a></li>
        <li class="nav-item"><a class="nav-link" href="tedXticket.html">Tickets</a></li>
        <li class="nav-item"><a class="nav-link" href="volunteer.html">Volunteer</a></li>
      </ul>

      <!-- Icons + Button -->
      <div class="d-flex align-items-center gap-3">
        <!-- <i class="fas fa-th text-white fs-5"></i> -->
        <a class="btn get-ticket-btn" href="tedXticket.html">GET TICKET</a>
      </div>
    </div>
  </div>
</nav>

<!-- Hero Section -->
<section class="hero-section text-white text-center py-5">
  <div class="container mt-5 pt-4">
    <!-- Title -->
    <h1 class="fw-bold display-4">TEDxTAU 2025</h1>
    <h2 class="fw-bold display-5 mb-4">Theme: Dream. Dare. Do.</h2>

    <!-- Date / Time -->
    <div class="mb-3 fs-5 fw-medium d-flex justify-content-center align-items-center flex-wrap gap-2">
      <span>October 11, 2025</span>
      <span class="dot-separator"></span>
      <span>10:00 AM – 4:00 PM</span>
    </div>

    <!-- Location -->
    <div class="fs-5">
      <strong>Location:</strong> Thomas Adewumi University, Oko, Kwara State<br />
      Auditorium
    </div>
  </div>
</section>

<section class="event-section container-fluid py-5">
  <div class="row g-0 align-items-start justify-content-center">
    
    <!-- LEFT: Event Image & Description -->
    <div class="col-lg-7 col-md-10 mb-4 mb-lg-0">
      <img src="./images/Artboard1.png" class="img-fluid rounded" alt="Event Artboard" />

      <div class="mt-4 px-2">
        <h2 class="fw-bold mb-3">About the Event?</h2>
        <p class="text-light fs-5">
          TEDxTAU 2025 is an independently organized TEDx event licensed by TED, bringing together innovators, changemakers, creatives, and thought leaders within and beyond Thomas Adewumi University. Through powerful talks, performances, and interactive sessions, TEDxTAU aims to spark conversations that matter, inspire new ideas, and build a community driven by curiosity and impact.
        </p>
      </div>
            <div class="mt-4 px-2">
        <h2 class="fw-bold mb-3">What to Expect?</h2>
        <p class="text-light fs-5">
            Inspiring Talks – Thought-provoking talks from speakers across diverse fields <br>

            Creative Performances – Artistic expressions to awaken imagination <br>

            Networking Opportunities – Connect with students, leaders, and professionals <br>

            Interactive Sessions – Engage in conversations that challenge perspectives <br>

            Community Vibes – A space to share, connect, and celebrate ideas worth spreading
        </p>
      </div>
            <div class="mt-4 px-2">
        <h2 class="fw-bold mb-3">Who Should Attend?</h2>
        <div class="d-flex gap-5">
            <ul class="text-light fs-5 list-unstyled">
                <li>Students & Young Innovators</li>
                <li>Entrepreneurs & Professionals</li>
                <li>Educators & Researchers</li>
                <li>Artists & Performers</li>
                <li>Community Builders & Changemakers</li>
            </ul>
            <ul class="text-light fs-5 list-unstyled mx-auto">
                <li>Data Scientists & Developers</li>
                <li>Business Leaders & Entrepreneurs</li>
                <li>Investors & Innovators</li>
            </ul>
        </div>
      </div>
    </div>

<div class="ticket-panel">
  <h4 class="mx-auto">🎟️ Buy Your Ticket</h4>
  <form class="ticket-form" id="ticketForm" novalidate>
    <label for="ticketType">Ticket Type</label>
    <select id="ticketType" name="ticketType" required onchange="showTicketDescription()">
      <!-- <option value="" disabled selected>---  Select  ---</option> -->
      <option value="" selected>---  Select  ---</option>
      <option value="standard">🎓 Standard – ₦5,000</option>
      <option value="gold">🌟 Gold – ₦10,000</option>
      <option value="premium">🚀 Premium – ₦15,000</option>
      <option value="vip">👑 VIP – ₦30,000</option>
    </select>

    <label id="ticketDescription" style="border: 1px solid #eee; padding: 10px; border-radius: 8px;"></label>

    <label for="quantity">Quantity</label>
    <input type="number" id="quantity" name="quantity" min="1" value="1" required disabled>

    <div class="name-row">
      <div>
        <label for="firstname">First Name</label>
        <input type="text" id="firstname" name="firstname" required>
      </div>
      <div>
        <label for="lastname">Last Name</label>
        <input type="text" id="lastname" name="lastname" required>
      </div>
    </div>

    <label for="email">Email</label>
    <input type="email" id="email" name="email" required>

    <label for="phone">Phone</label>
    <input type="tel" id="phone" name="phone" required>

    <div class="price-box" id="priceBox">Total Price: ₦0</div>
    <div class="small" id="message"></div>


    <button type="submit" class="btn-primary" id="submitBtn">Proceed to Pay</button>
  </form>
</div>

        <!-- Pass Type -->
        <!-- <div class="form-control bg-transparent border-light text-white mb-3">
          Silver Pass
        </div> -->

        <!-- Price + Quantity
        <div class="d-flex justify-content-between align-items-center border border-light rounded p-3 text-white mb-4">
          <div>
            <div class="fs-5 fw-bold">$285.00</div>
            <div class="text-light small">Unlimited</div>
          </div>
          <div class="d-flex align-items-center gap-3">
            <button class="btn text-white fs-4 px-2">-</button>
            <span class="fs-5">1</span>
            <button class="btn text-white fs-4 px-2">+</button>
          </div>
        </div> -->

        <!-- Quantity & Total
        <div class="mb-3 text-white">
          <div><strong>Quantity:</strong> 01</div>
          <div><strong>Total Cost:</strong> $285.00</div>
        </div>

        -- Purchase Button -->
        <!-- <button class="btn btn-primary Purchase w-100 fw-bold py-2 mt-2">PURCHASE NOW</button> -->
      </div>
    </div>
  </div>
</section>

  <div class="container">
    <h2>Speakers</h2>
    <div class="row g-4 mt-3">
      <div class="col-md-6">
        <div class="speaker-img position-relative">
          <img src="/images/Iremide's Pic 2.jpg" alt="Iremide Adeoye" />
          <a href="https://ng.linkedin.com/in/iremide-adeoye-4250171a5" class="link-icon" aria-label="Link to Iremide Adeoye profile">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-link-45deg" viewBox="0 0 16 16">
              <path d="M4.715 6.542a3.237 3.237 0 0 1 4.57-4.57l.829.828a.5.5 0 0 0 .707-.708l-.828-.829a4.237 4.237 0 0 0-6.001 6.001l1.528 1.528a.5.5 0 0 0 .707-.708L4.715 6.54zm6.121 2.915a3.237 3.237 0 0 1-4.57 4.57l-.829-.828a.5.5 0 0 0-.707.708l.828.829a4.237 4.237 0 0 0 6.001-6.001l-1.528-1.528a.5.5 0 0 0-.707.708l1.528 1.528z"/>
              <path d="M6.286 9.193a.5.5 0 0 0 0 .707l2.829 2.828a.5.5 0 0 0 .707 0l3.536-3.536a.5.5 0 0 0 0-.707L10.243 6.657a.5.5 0 0 0-.707 0l-3.25 3.25z"/>
            </svg>
          </a>
        </div>
        <h3 class="speaker-name"><span class="purple-dot">●</span> Iremide Adeoye</h3>
        <p class="speaker-role">Nigerian actor A.K.A "Fantasticks" </p>
      </div>

      <div class="col-md-6">
        <div class="speaker-img position-relative">
          <img src="/images/Victory Ashaka Headshot .jpg" alt="Victory Ashaka" />
          <a href="https://victoryashaka.com/" class="link-icon" aria-label="Link to Victory Ashaka profile">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-link-45deg" viewBox="0 0 16 16">
              <path d="M4.715 6.542a3.237 3.237 0 0 1 4.57-4.57l.829.828a.5.5 0 0 0 .707-.708l-.828-.829a4.237 4.237 0 0 0-6.001 6.001l1.528 1.528a.5.5 0 0 0 .707-.708L4.715 6.54zm6.121 2.915a3.237 3.237 0 0 1-4.57 4.57l-.829-.828a.5.5 0 0 0-.707.708l.828.829a4.237 4.237 0 0 0 6.001-6.001l-1.528-1.528a.5.5 0 0 0-.707.708l1.528 1.528z"/>
              <path d="M6.286 9.193a.5.5 0 0 0 0 .707l2.829 2.828a.5.5 0 0 0 .707 0l3.536-3.536a.5.5 0 0 0 0-.707L10.243 6.657a.5.5 0 0 0-.707 0l-3.25 3.25z"/>
            </svg>
          </a>
        </div>
        <h3 class="speaker-name"><span class="purple-dot">●</span> Victory Ashaka</h3>
        <p class="speaker-role">Spoken Word Poet</p>
      </div>
    </div>

    <div class="event-overview mt-5">
      <h2>Event Overview</h2>
      <p>
        TEDxTAU is more than an event – it’s a movement of ideas within Thomas Adewumi University and beyond. This year’s edition will feature inspiring talks, breathtaking performances, and engaging conversations designed to challenge perceptions and ignite creativity.
      </p>
      <p>
        Join us for a day of inspiration, connection, and transformation.      
      </p>
    </div>
      <button class="btn btn-primary custom-btn">ADD TO CALENDER</button>
  </div>


   <section class="event-info mt-3">
    <div class="container">
      <div class="row gy-4">
        <!-- Detail -->
        <div class="col-md-3">
          <h5 class="section-title">Detail</h5>
          <p><span class="info-label">COST:</span><br />Ticket prices start at $5,000.00</p>
          <p><span class="info-label">DATE:</span><br />October 16, 2025</p>
          <p><span class="info-label">TIME:</span><br />Saturday, 10:00 AM – 4:00 PM</p>
        </div>

        <!-- Organizer -->
        <div class="col-md-3">
          <h5 class="section-title">Organizer</h5>
          <p>Lily Aimas Love</p>
          <p><span class="info-label">CONTACT:</span><br /><a href="tel:+2348012345678">Call Us at +2348012345678</a></p>
          <p><span class="info-label">EMAIL:</span><br /><a href="mailto:lily.aimas@tau.edu.ng">lily.aimas@tau.edu.ng</a></p>
          <p>eventsponsors.com</p>
        </div>

        <!-- Venue -->
        <div class="col-md-3">
          <h5 class="section-title">Venue</h5>
          <p><span class="info-label">LOCATION:</span><br />University Auditorium</p>
          <p><span class="info-label">CONTACT:</span><br />+1-416-8241228</p>
          <p><span class="info-label">EMAIL:</span><br />info@email.com</p>
        </div>

        <!-- Map -->
        <div class="col-md-3 " style="position:relative;width:100%;padding-bottom:56.25%;height:0;overflow:hidden;border-radius:8px;">
           <iframe
          src="https://www.google.com/maps?q=Thomas+Adewumi+University+University+Drive+Off+Idofin+Road+Oko-Irese+Kwara+State+Nigeria&output=embed"
          style="position:absolute;top:0;left:0;width:100%;height:100%;border:0;"
          allowfullscreen=""
          loading="lazy"
          referrerpolicy="no-referrer-when-downgrade"
          title="Thomas Adewumi University Map">
        </iframe>
        </div>
      </div>
    </div>
  </section>
<!-- <footer>
  <div class="container d-flex flex-wrap justify-content-between">
    <div>
      <div class="footer-logo">
        <img src="./images/tau.png" alt="Daevnt Logo" class="w-50"/>
      </div>
      <p class="footer-description">
        Pellentesque nec tempor sapien. Pellentesque vel placerat nibh. Suspendisse venenatis.
      </p>
      <form class="subscribe-form" onsubmit="event.preventDefault(); alert('Subscribed!');">
        <input type="email" placeholder="Enter Your Email Address" required />
        <button type="submit">Subscribe</button>
      </form>
    </div>

    <div class="footer-links">
      <h5>Useful Link</h5>
      <ul>
        <li><a href="#">About Events</a></li>
        <li><a href="#">Future Events</a></li>
        <li><a href="#">Top Speakers</a></li>
        <li><a href="#">Faq Pages</a></li>
        <li><a href="#">Get Ticket</a></li>
      </ul>
    </div>

    <div class="footer-contact">
      <h5>Address:</h5>
      <p>612-7 Roanoke Rd, Toronto,<br />ON M3A 1E3, Canada</p>
      <p><strong>Phone:</strong> +1-416-8241228</p>
      <p><strong>Email:</strong> info@email.com</p>
    </div>
  </div>

  <button class="back-to-top" aria-label="Back to top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
    &uarr;
  </button>
</footer> -->

<div id="footer"></div>

<script>
  fetch("components/footer.html")
    .then(res => res.text())
    .then(data => {
      document.getElementById("footer").innerHTML = data;
    });
</script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- <script>

    const ticketPrices = { regular: 5000, vip: 50000 };
    const ticketTypeEl = document.getElementById("ticketType");
    const quantityEl = document.getElementById("quantity");
    const priceBox = document.getElementById("priceBox");

    // Update displayed price dynamically
    function updatePrice() {
      let type = ticketTypeEl.value;
      let qty = parseInt(quantityEl.value || 1);
      if (type && ticketPrices[type]) {
        let total = ticketPrices[type] * qty;
        priceBox.textContent = `Total Price: ₦${total}`;
      } else {
        priceBox.textContent = "Total Price: ₦0";
      }
    }
    ticketTypeEl.addEventListener("change", updatePrice);
    quantityEl.addEventListener("input", updatePrice);

    document.getElementById("ticketForm").addEventListener("submit", async function(e){
      e.preventDefault();

      let ticketType = ticketTypeEl.value;
      let quantity = parseInt(quantityEl.value);
      let firstname = document.getElementById("firstname").value;
      let lastname = document.getElementById("lastname").value;
    //   let department = document.getElementById("department").value;
      let email = document.getElementById("email").value;
      let phone = document.getElementById("phone").value;

      try {
        // 1️⃣ Create Ticket

        let ticketRes = await fetch("http://localhost:8080/api/create-ticket/", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            ticket_type: ticketType,
            quantity: quantity,
            totalPrice: ticketPrices[ticketType] * quantity
          })
        });

        let ticketData = await ticketRes.json();
        if (ticketData.status !== "success") {
          alert("Error creating ticket: " + JSON.stringify(ticketData));
          return;
        }
        let ticketId = ticketData.ticket_id;   // must be returned from backend
        let totalPrice = ticketData.total_price;

        // 2️⃣ Add Contact
        let contactRes = await fetch(`https://ticketing-2x61.onrender.com/api/ticket/${ticketId}/contact/`, {

          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            firstname,
            lastname,
            // department,
            email,
            phone
          })
        });

        let contactData = await contactRes.json();
        if (!contactData || contactData.error) {
          alert("Error saving contact: " + JSON.stringify(contactData));
          return;
        }

        // 3️⃣ Initialize Payment
        let payRes = await fetch(`https://ticketing-2x61.onrender.com/api/ticket/initialize-payment/`, {
        // let payRes = await fetch(`http://localhost:8080/api/ticket/${ticketId}/initialize-payment/`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            ticket_id: ticketId,
            // local_reference: payData ? payData.reference : null,
            email: email
          })
        });

        let payData = await payRes.json();
        console.log(payData);
        if (payData.error) {
          alert("Error initializing payment: " + payData.error);
          console.error(payData);
          console.log("Payment initialization failed");
          return;
        }

        // 4️⃣ Open Monnify Payment
       MonnifySDK.initialize({
          amount: Number(payData.amount), // ensure number
          currency: "NGN",
          reference: payData.reference, // unique per transaction
          customerFullName: payData.customerName,
          customerEmail: payData.customerEmail,
          customerPhone: payData.customerPhone || "08000000000",
          apiKey: "MK_TEST_VZ3SL4J3A5",   // must be PUBLIC KEY
          contractCode: "4216477966",
          paymentDescription: "Event Ticket Purchase",
          isTestMode: true,
          metadata: {
            ticket_id: ticketId,
            ticketType: ticketType,
            quantity: quantity,
          },
          onLoadStart: () => {
            console.log("Monnify popup loading...");
          },
          onLoadComplete: () => {
            console.log("Monnify popup loaded.");
          },
          onComplete: function(response) {
            console.log("Transaction completed: ", response);
            // here response.paymentReference is the correct one to use
          },
          onClose: function(data) {
            console.log("Payment closed: ", data);
          }
        });


      } catch (err) {
        console.error(err);
        alert("Something went wrong. Check console.");
      }
    });
  </script> -->


<script>


  function showTicketDescription() {
    const ticketType = document.getElementById("ticketType").value;
    const descriptionDiv = document.getElementById("ticketDescription");

    let description = "";

    if (descriptionDiv) {
      descriptionDiv.style.display = ticketType ? "block" : "none";
    }

    switch(ticketType) {
      case "standard":
          description = `
            <ul>
              <li>The entry point for students and community members.</li>
              <li>Admission to all talks</li>
              <li>Access to networking sessions</li>
              <li>Complimentary light refreshments</li>
            </ul>`;
        break;
      case "gold":
          description = `
  <ul>
    <li>A more comfortable experience with a few extras.</li>
    <li>Everything in Standard</li>
    <li>Reserved seating for better visibility</li>
    <li>Lunch served during intermission</li>
    <li>TEDxTAU-themed stationery</li>
  </ul>
`;
        break;
      case "premium":
  description = `
    <ul>
      <li>For those who want to experience TEDxTAU with more exclusivity.</li>
      <li>All Gold benefits</li>
      <li>TEDxTAU-branded souvenirs</li>
      <li>Priority seating near the stage</li>
    </ul>
  `;
  break;

case "vip":
  description = `
    <ul>
      <li>An all-access pass with the highest level of recognition.</li>
      <li>All Premium benefits</li>
      <li>Complimentary snacks throughout the event</li>
      <li>Official TEDxTAU branded T-shirt</li>
      <li>Exclusive photo opportunities and private networking with speakers/curators</li>
    </ul>
  `;
  break;

      
      default:
        description = "";
    }

    descriptionDiv.innerHTML = description;
  }




    // ---------- CONFIG ----------
    const BASE_URL = "https://ticketing-2x61.onrender.com"; // update if needed
    const MONNIFY_API_KEY = "MK_TEST_VZ3SL4J3A5"; // replace with your API key
    const MONNIFY_CONTRACT = "4216477966"; // replace with your contract code
    // ----------------------------

    const ticketPrices = { standard: 5000, gold: 10000, premium: 15000, vip: 30000 };
    const ticketTypeEl = document.getElementById("ticketType");
    const quantityEl = document.getElementById("quantity");
    const priceBox = document.getElementById("priceBox");
    const messageEl = document.getElementById("message");
    const submitBtn = document.getElementById("submitBtn");
    const form = document.getElementById("ticketForm");

    // Format NGN nicely
    const formatNaira = n => new Intl.NumberFormat('en-NG').format(n || 0);

    // update displayed price
    function updatePrice() {
      const type = ticketTypeEl.value;
      const qty = Math.max(1, parseInt(quantityEl.value || 1));
      if (type && ticketPrices[type]) {
        const total = ticketPrices[type] * qty;
        priceBox.textContent = `Total Price: ₦${formatNaira(total)}`;
      } else {
        priceBox.textContent = "Total Price: ₦0";
      }
    }

    ticketTypeEl.addEventListener("change", updatePrice);
    quantityEl.addEventListener("input", updatePrice);
    // run once on load
    updatePrice();

    // Helper to safe-parse JSON or return text
    async function safeParseResponse(res) {
      const text = await res.text();
      try {
        return JSON.parse(text);
      } catch (e) {
        return { __raw: text };
      }
    }

    // Helper to show messages to user
    function showMessage(text, isError = false) {
      messageEl.textContent = text;
      messageEl.style.color = isError ? "#C62828" : "#2E7D32";
    }

    form.addEventListener("submit", async function (e) {
      e.preventDefault();
      showMessage("");
      // basic client validation
      if (!ticketTypeEl.value) { showMessage("Please select a ticket type.", true); ticketTypeEl.focus(); return; }
      if (!quantityEl.value || parseInt(quantityEl.value) < 1) { showMessage("Quantity must be at least 1.", true); quantityEl.focus(); return; }
      if (!document.getElementById("firstname").value.trim()) { showMessage("First name is required.", true); return; }
      if (!document.getElementById("lastname").value.trim()) { showMessage("Last name is required.", true); return; }
      if (!document.getElementById("email").value.trim()) { showMessage("Email is required.", true); return; }
      if (!document.getElementById("phone").value.trim()) { showMessage("Phone is required.", true); return; }

      // disable UI
      submitBtn.disabled = true;
      submitBtn.textContent = "Processing...";

      // gather values
      const ticketType = ticketTypeEl.value;
      const quantity = Math.max(1, parseInt(quantityEl.value || 1));
      const firstname = document.getElementById("firstname").value.trim();
      const lastname = document.getElementById("lastname").value.trim();
      const email = document.getElementById("email").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const computedTotal = (ticketPrices[ticketType] || 0) * quantity;

      try {
        console.log("Creating ticket...", { ticketType, quantity, computedTotal });

        // 1) Create ticket (send both possible field names to be tolerant)
        const createRes = await fetch(`${BASE_URL}/api/create-ticket/`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            ticket_type: ticketType,
            quantity,
            totalPrice: computedTotal,
            total_price: computedTotal
          })
        });

        if (!createRes.ok) {
          const errBody = await safeParseResponse(createRes);
          console.error("Create ticket non-OK response:", createRes.status, errBody);
          throw new Error(`Create-ticket failed (status ${createRes.status}): ${JSON.stringify(errBody)}`);
        }

        const ticketData = await safeParseResponse(createRes);
        console.log("Create ticket response:", ticketData);

        // Accept common success shapes: { status: 'success', ticket_id: 1 } OR { success: true, ticket_id: ... }
        const createdOk =
          (ticketData.status && ticketData.status.toLowerCase() === "success") ||
          ticketData.success === true ||
          ticketData.ticket_id;

        if (!createdOk) {
          throw new Error("Ticket creation returned unexpected payload: " + JSON.stringify(ticketData));
        }

        const ticketId = ticketData.ticket_id || ticketData.id || ticketData.data?.ticket_id;
        if (!ticketId) throw new Error("No ticket id returned by create-ticket endpoint.");

        // 2) Save contact
        console.log("Saving contact for ticket:", ticketId);
        const contactRes = await fetch(`${BASE_URL}/api/ticket/${ticketId}/contact/`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ firstname, lastname, email, phone })
        });

        if (!contactRes.ok) {
          const errBody = await safeParseResponse(contactRes);
          console.error("Contact non-OK response:", contactRes.status, errBody);
          throw new Error(`Contact saving failed (status ${contactRes.status}): ${JSON.stringify(errBody)}`);
        }
        const contactData = await safeParseResponse(contactRes);
        console.log("Contact response:", contactData);
        if (contactData.error || contactData.success === false) {
          throw new Error("Contact saving returned error: " + JSON.stringify(contactData));
        }

        // 3) Initialize payment
        console.log("Initializing payment for ticket:", ticketId);
        // Send the ticket id as body; your backend may expect a different path - this is tolerant
        const initRes = await fetch(`${BASE_URL}/api/ticket/initialize-payment/`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ ticket_id: ticketId, email })
        });

        if (!initRes.ok) {
          const errBody = await safeParseResponse(initRes);
          console.error("Init payment non-OK response:", initRes.status, errBody);
          throw new Error(`Payment initialization failed (status ${initRes.status}): ${JSON.stringify(errBody)}`);
        }

        const payData = await safeParseResponse(initRes);
        console.log("Payment init response:", payData);

        // Validate necessary fields exist
        const amount = payData.amount || payData.data?.amount || computedTotal;
        const reference = payData.reference || payData.data?.reference || payData.paymentReference || payData.transactionReference;
        const customerName = payData.customerName || `${firstname} ${lastname}`;
        const customerEmail = payData.customerEmail || email;
        const customerPhone = payData.customerPhone || phone;
        const paymentDescription = payData.paymentDescription || "Event Ticket Purchase";
        const redirectUrl = payData.redirectUrl || payData.data?.redirectUrl || BASE_URL;

        if (!amount || !reference) {
          throw new Error("Payment initialization response missing `amount` or `reference`: " + JSON.stringify(payData));
        }

        showMessage("Opening payment widget...");

        // 4) Open Monnify widget
        if (typeof MonnifySDK === "undefined") {
          throw new Error("Monnify SDK is not loaded. Check network / CSP and that https://sdk.monnify.com/plugin/monnify.js is reachable.");
        }

        // Initialize Monnify - this should open the widget
        // MonnifySDK.initialize({
        //   amount: Number(amount),
        //   currency: "NGN",
        //   reference: reference,
        //   customerFullName: customerName,
        //   customerEmail: customerEmail,
        //   customerPhone: customerPhone,
        //   apiKey: MONNIFY_API_KEY,
        //   contractCode: MONNIFY_CONTRACT || "4216477966",
        //   paymentDescription: paymentDescription,
        //   isTestMode: true,
        //   redirectUrl: redirectUrl,
        //   metadata: { ticket_id: ticketId, ticketType, quantity },
        //   onLoadStart: () => {
        //     console.log("Monnify popup loading...");
        //   },
        //   onLoadComplete: () => {
        //     console.log("Monnify popup loaded.");
        //   },
        //   onComplete: function (response) {
        //     console.log("Monnify onComplete:", response);
        //     // The SDK sometimes returns a 'status' or paymentReference; check common shapes
        //     const status = response.status || response.paymentStatus || response.txnStatus;
        //     if (String(status).toUpperCase() === "PAID" || response.paymentReference || response.transactionReference) {
        //       alert("✅ Payment Successful! Ticket will be emailed.");
        //       showMessage("Payment successful. Thank you!");
        //       // Optionally redirect to success page here
        //     } else {
        //       alert("❌ Payment Failed or Cancelled");
        //       showMessage("Payment was not successful.", true);
        //     }
        //     // re-enable button after completion
        //     submitBtn.disabled = false;
        //     submitBtn.textContent = "Proceed to Pay";
        //   },
        //   onClose: function () {
        //     console.log("Monnify widget closed by user.");
        //     showMessage("Payment widget closed.", true);
        //     submitBtn.disabled = false;
        //     submitBtn.textContent = "Proceed to Pay";
        //   }
        // });
 MonnifySDK.initialize({
          amount: Number(payData.amount), // ensure number
          currency: "NGN",
          reference: payData.reference, // unique per transaction
          customerFullName: payData.customerName,
          customerEmail: payData.customerEmail,
          customerPhone: payData.customerPhone || "08000000000",
          apiKey: "MK_TEST_VZ3SL4J3A5",   // must be PUBLIC KEY
          contractCode: "4216477966",
          paymentDescription: "Event Ticket Purchase",
          isTestMode: true,
          metadata: {
            ticket_id: ticketId,
            ticketType: ticketType,
            quantity: quantity,
          },
          onLoadStart: () => {
            console.log("Monnify popup loading...");
          },
          onLoadComplete: () => {
            console.log("Monnify popup loaded.");
          },
          onComplete: (res) => {
            if (res.paymentStatus === "PAID") {
              // alert("✅ Payment Successful! Ticket will be emailed.");
              console.log("Payment Successful! Ticket will be emailed.");
              // window.location.href = `http://localhost:5500/gpt/payment_success.html`;
              // window.location.href = `http://localhost:5500/gpt/payment_success.html?ticketId=${ticketId}&paymentReference=${paymentReference}`;
              // window.location.href = `https://localhost:5501/ery-Do-Not-Delete/payment_success.html?ticketId=${ticketId}&paymentReference=${customerName}`;
              window.location.href = `https://ery-001.github.io/tedXtau-payment_success/payment_success.html?ticketId=${ticketId}&paymentReference=${customerName}`;
              // window.location.href = `${BASE_URL}/api/ticket/${ticketId}/ticket/send-ticket/`;


            } else {
              alert("❌ Payment Failed or Cancelled");
            }
            // if (res.paymentStatus === "PAID") {
            //   alert("✅ Payment Successful! Ticket will be emailed.");
            //   // window.location.href = `http://localhost:8080/api/ticket/${ticketId}/ticket/send-ticket/`;
            // } else {
            //   alert("❌ Payment Failed or Cancelled");
            // }
          },
          onClose: function(data) {
            console.log("Payment closed: ", data);
          }
        });

      } catch (err) {
        console.error("Error flow:", err);
        showMessage("Something went wrong. Check console for details.", true);
        alert("Something went wrong. See console (F12) for details.");
        submitBtn.disabled = false;
        submitBtn.textContent = "Proceed to Pay";
      }
    });
  </script>
</body>
</html>
